---
title: "Visualise ascotracR output"
author: "Paul Melloy"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Visualise ascotracR output}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
  %\usepackage{extrafont}
  %\VignetteDepends{cowplot}
  %\VignetteDepends{ggplot2}
  %\VignetteDepends{ggpubr}
  %\VignetteDepends{readxl}
  %\VignetteDepends{ggpubr}
  %\VignetteDepends{lubridate}
  %\VignetteDepends{viridis}
  %\VignetteDepends{showtext}
  %\VignetteDepends{here}
  %\VignetteDepends{patchwork}
  %\VignetteDepends{classInt}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, error = TRUE)
knitr::opts_chunk$set(progress = TRUE, verbose = TRUE)
knitr::opts_chunk$set(
  echo = TRUE,
  fig.width = 7,
  fig.height = 7,
  fig.align = "center"
)
```

```{r fonts, include=FALSE, message=FALSE, eval=FALSE}
# Note that GhostScript needs to be installed at the system level for the PS files to be generated.
# MacOS users can use `brew install ghostscript`
# 
# Windows users can follow these directions:
# 1.	Go to the GhostScript website (https://www.ghostscript.com/download/gsdnld.html)
# 2.	Download the windows installer suitable for your machine
# 3.	Run the installer file which you downloaded and follow the prompts
# 4.	After running the installer click the windows "Start" button and type "Edit environment variables for your account" and open
# 5.	In the tab 'Advanced' click the button at the bottom 'Environment Variables...'
# 6.	Under 'System variables' find the variable 'Path', select 'Path' and click the 'Edit' button
# 7. 	Select a new line and copy the Ghostscript 'bin' folder location into the field.
# 7.1	If you installed ghostscript to the default folder location; then the folder location will likely be "C:\Program Files\gs\gs9.52\bin", the version number (9.52) may differ.
# 8.	Save and exit the environmental variables window
# This chunk is then run only if knitting on new computer that the files have not been generated on
# this is necessary to embed fonts in .eps files 
library("extrafont")
if (.Platform$OS.type == "windows") {
   font_import(pattern = "arial", prompt = FALSE)
   loadfonts(device = "postscript", quiet = TRUE)
} else {
   font_import(pattern = "Arial", prompt = FALSE)
   loadfonts(device = "postscript", quiet = TRUE)
}
```

## Load libraries 

```{r libraries, message=FALSE, echo=TRUE, warning=FALSE}
library("readxl")
library("cowplot")
library("ggplot2")
library("ggpubr")
library("grDevices")
library("dplyr")
library("lubridate")
library("viridis")
library("showtext")
library("readr")
library("here")
library("patchwork")
library("classInt")
library("extrafont")
library("knitr")

extrafont::loadfonts()
```


## Heat map

```{r heat-map, message=FALSE, warning=FALSE, fig.cap="Heatmaps showing observed and simulated Ascochyta blight development from primary infection foci"}
```

Heatmaps showing the presence or absence of disease in each observation quadrat at the increasing distances (0–10 m) from the primary infection foci. Both X and Y axes should show 0 m distance at the middle reaching out to 10 m distance on either side. The simulated model output is disease severity (number of lesions), and we calculated disease incidence (percentage of infected plants) in the field. Both are not directly comparable; therefore, we probably need to follow binomial distribution. 

### Step by step procedure 

-	Data wrangling of observed data frame to fit binomial distribution 

observed %>%
mutate(incidence = incidence / 100) %>%  (optional step)    
  mutate(observed_presence = if_else(incidence > 0, 1, 0))

-	Data wrangling of predicted data frame to fit binomial distribution 

predicted %>%
 mutate(infected_gp = infected_gp / 40) %>%  # seeding rate = 40 (optional step)
 mutate(predicted_presence = if_else(infected_gp > 0, 1, 0))

-	Run the model with Billa Billa weather data and produce the heatmap (prediction), then combine it with the heatmap produced from the field experiment (observation). Repeat the same for Tosari [Link to the heatmap from the experiment is shown here](https://ihsankhaliq.github.io/spatiotemporaldynamics/articles/Data_visualisation.html)  


FIGURE


### Results

In the field experiment, the rate of spatial and temporal disease progress was faster in quadrats located closer to the inoculated central quadrat compared to those located towards plots edges. The pattern of disease spread was largely patchy. Figure xx shows the model largely captured the spatial patterns of disease spread, but it tended to overestimate/underestimate the level of infection towards plots edges at Tosari/Billa. The model showed/did not show any patchiness in spatial patterns of disease spread.  


## Line graph (disease progress curve)

```{r line-graph, message=FALSE, warning=FALSE, fig.cap="Disease progress curves showing observed and simulated incidence of Ascochyta blight over a chickpea growing season"}
```

Disease progress curve should ideally show `assessment_date` on x-axis, `distance` on y-axis on the right and percent disease incidence on y-axis on the left (dual axis). [An example to line graph from the experiment is shown here](https://ihsankhaliq.github.io/spatiotemporaldynamics/articles/Data_visualisation.html). If this is tricky to produce by simulated model, we can do what Art has done. That is, distances on the x-axis and proportion (0-1) of infected quadrats on y-axis, and assessment date at the top of the graph. A simple line graph showing observed and simulated curves in different colors will do.  


FIGURE


## Results

### Observation Vs. simulation – a comparison of spatiotemporal disease development 

In the field experiment, disease incidence increased with each assessment date (assessment number) approaching 100 % disease incidence by assessment 10 at Billa Billa and assessment 8 at Tosari. It took a total of 113 days to reach 100% disease incidence across all four replicated plots at Tosari compared to Billa Billa where it took 132 days to reach 100% disease incidence across all four replicated plots. 
Disease incidence simulated by the model was compared with the observed incidence from the field experiment for a total of 10 times at Billa Billa and 8 times at Tosari. At all observation dates, the model’s prediction was very close to the observed incidence data at both locations, but the model underestimated/overestimated disease at assessment xxx at Tosari and assessment xxxx at Billa Billa. Overall, the model underestimated/overestimated disease incidence at beginning of the season and underestimated/overestimated disease incidence towards the end of the season. 


## Time course of growing points graph

```{r growing-points-graph, message=FALSE, warning=FALSE, fig.cap="Time course of accumulated healthy, new, and newly infective growing points for a subunit in lupin field"}

```

Growing points dynamics graph is just simulation to demonstrate how the number of healthy (column 1), new growing points per day (column 2) and newly infected growing points (column 3) dynamic change over time. It doesn’t need to be produced for two locations or compared with observations. For this, I’d choose the inoculated central quadrat (F) of replicated plot-1 at Billa Billa. Two plants were infected 29 days (assessment-2 i.e., 16 July 2020) after inoculum was introduced (two plants were infected in the central quadrat of replicated plot 1 – the heading of the column is plot in the spreadsheet). There were two lesions in total, so you could say 2 growing points were infected on day 29 after inoculation. 100 % loss of growing points in the inoculated central quadrat of plot 1 occurred by assessment-6 (10 September 2020), which is 85 days after inoculum introduction. 

Alternatively, you can choose the whole paddock for Billa Billa. Initial infection occurred 29 days after inoculation (16-July-2020) and 100 % disease was observed 132 days after inoculation (27-10-2020)

Scenario A: No infection. For instance, any date before inoculum was introduced into plots, say 15 June 2020 (location Billa Billa) 

Scenario B: 2 growing points become newly infected 29 days (assessment-2 i.e., 16 July 2020) after inoculum was introduced. Infection location is inoculated central quadrat (F) of replicated plot 1 (the heading of the column is PLOT in the spreadsheet).

Scenario C: A simulation of disease spread from 2 infected growing points. That is, how much disease spread from newly infected growing points. 100 % loss of growing points in the inoculated central quadrat of replicated plot 1 occurred by assessment-6 (10 September 2020), which is 85 days after inoculum introduction.

Please note that this is based on **SIMULATION** in a **SINGLE** subunit (could be a quadrat or a paddock - quadrat seem easy to handle). We are just demonstrating that how growing points dynamics change when there is no infection and when there is infection

-	The model may not simulate 100% loss in the quadrat (F) by 10 September 2020, which is fine. 
-	We do not need to follow binomial distribution for this graph 


FIGURE


## Results

Dynamics of growing points

The number of healthy and new growing points in a subunit increased in a continuous fashion in the absence of an infection (Figure xxA). The number of healthy growing points immediately reduced when 2000 growing points become infected on day 60 of sowing (Figure xxB). By day 90, there was a complete loss of growing points in the subunit where an infection had taken place (Figure xxC). 



