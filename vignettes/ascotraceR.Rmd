---
title: ascotraceR
author: "Vignette Author" 
output:
  rmarkdown::html_document:
    theme: journal
vignette: >
  %\VignetteIndexEntry{ascotraceR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  %\VignetteDepends{ggplot2}
---

## Introduction to _ascotraceR_

_ascotraceR_ is an R package of the 'ascotraceR' model developed to simulate the spread of Ascochyta blight in a chickpea field over a growing season.
Parameters and variables used in the model were mostly derived from the literature and were subjected to validation in the field.
The model uses daily weather data to simulate disease spread and a set of weather data is included with the package for demonstration purposes.

### Getting started

Load the library.

```{r, load-libs}
library("ascotraceR")
```

Import the weather data

```{r load-weather}
# weather data
Newmarracarra <- read.csv(
  system.file("extdata",
              "1998_Newmarracarra_weather_table.csv", package = "ascotraceR")
)

head(Newmarracarra)

# weather station location information
station_data <-
  system.file("extdata", "stat_dat.csv", package = "ascotraceR")
```

### Wrangle weather data 

A function, `format_weather()`, is provided to convert raw weather data into the format appropriate for the model.
It is mandatory to format weather data before running the model.
Time zone can also be set manually using `time_zone` argument.
If latitude and longitude are not supplied in the raw weather data, a a separate CSV file listing latitude and longitude can be supplied to meet this requirement (see `?format_weather` for more details).

```{r format-weather}
weather_dat <- format_weather(
  x = Newmarracarra,
  POSIXct_time = "Local.Time",
  temp = "mean_daily_temp",
  ws = "ws",
  wd_sd = "wd_sd",
  rain = "rain_mm",
  wd = "wd",
  station = "Location",
  time_zone = "Australia/Perth",
  lonlat_file = station_data
)
```

### Simulate Ascochyta blight spread

A function, `trace_asco()`, is provided to simulate the spread of Ascochyta blight in a chickpea field over a growing season.
The inputs needed to run the function include weather data, paddock length and width, sowing and harvest dates, chickpea growing points replication rate, primary infection intensity, latent period, number of conidia produced per lesion and the location of primary infection foci (centre or random).
The model output is a nested list with items for each day of the model run.
See the help file for `trace_asco()` for more information.

```{r trace-asco}
# Predict Ascochyta blight spread for the year 1988 at Newmarracarra
traced <- trace_asco(
  weather = weather_dat,
  paddock_length = 100,
  paddock_width = 100,
  initial_infection = "1998-06-10",
  sowing_date = as.POSIXct("1998-06-09"),
  harvest_date = as.POSIXct("1998-06-09") + lubridate::ddays(100),
  time_zone = "Australia/Perth",
  primary_infection_foci = "centre"
)
```

### Tidy up or summarise the model output

Functions `tidy_trace()` and `summarise_trace()` have been provided to tidy up and summarise the model output

## Tidy up the model output 

```{r tidy}
tidied <- tidy_trace(traced)
tidied
```


### Summarise the model output

```{r summarise}
summarised <- summarise_trace(traced)
summarised
```

## Plot using _ggplot2_

Plot the number of infectious growing points on day 102.

```{r plot}

library("ggplot2")

ggplot(data = subset(tidied, i_day == 102),
       aes(x = x, y = y, fill = infectious_gp)) +
  geom_tile()
```

